"0","#====obs table===="
"0","df_obs <- mrs_obs %>%"
"0","  left_join(mrs_concept %>%"
"0","              select(concept_id, concept_name, short_name,"
"0","                     description, datatype, concept_class,"
"0","                     hi_absolute, hi_critical, hi_normal,"
"0","                     low_absolute, low_critical, low_normal,"
"0","                     units, precise),"
"0","            by = ""concept_id"") %>%"
"0","  left_join(., y = mrs_concept %>%"
"0","              select(concept_id,"
"0","                     ans_name = concept_name,"
"0","                     ans_description = description),"
"0","            by = c(""value_coded"" = ""concept_id""))"
"0","#df_hiv"
"0","df_hiv <- df_obs %>%"
"0","  filter(grepl(""CURRENT WHO HIV STAGE"", concept_name, ignore.case = T) & !is.na(ans_name)) %>%"
"0","  select(encounter_id, patient_id, hiv_stage = ans_name) %>%"
"0","  distinct() %>%"
"0","  mutate(hiv_stage = as.integer(gsub(""\\D"", """", hiv_stage))) %>%"
"0","  distinct()"
"0","#data.frame(head(df_hiv %>% count(patient_id, hiv_stage) %>% filter(n > 1)))"
"0","data.frame(head(df_hiv %>% count(encounter_id) %>% filter(n > 1)))"
