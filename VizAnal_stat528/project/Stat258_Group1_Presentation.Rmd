---
title: "Stat258 Group1 Presentation - Dallas Animal Shelter"
author: 'Group 1: Alex Brown, Megan Schmitt, Sarah Diercks, Jamie Helm'
date: "December 3, 2018"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Project Description

For our group assignment, we have chose to look at a data set from an Animal Shelter's in Dallas, TX. Animal shelters help animals find new homes and maintain a safe city. We believe this data set can be used to help this shelter save money and operate more efficiently. In addition this data set can be used in various ways such as marketing, keeping appropriate inventory of pet supplies on hand, and staffing necessary resources at certain times.

The Dallas Animal Shelter data set can be found on the [TidyTuesday](https://github.com/rfordatascience/tidytuesday) project website at the following link: [week18_dallas_animals.xlsx](https://github.com/rfordatascience/tidytuesday/blob/master/data/2018-07-31/week18_dallas_animals.xlsx)

## Outline

Our intentions with this data set is to answer a multitude of different questions that could help the animal shelter in the future. We think the following questions can help the animal shelter optimize a plan for incoming pets and try to maximize the opportunity for a pet to get adopted:

* Is there any spikes for adoptions and intake? And can we link them to any reasons?
* How long are animals typically at the shelter? How long for different outcomes?
* Which animals are most likely to be adopted?
* Which animals/breed  are adopted the quickest?
* Does a particular `intake_type` or condition lead to a faster turnaround?

## Packages Used

* `readxl` - to read in excel files.
* `scales` - for adjusting graphics legends and axes.
* `lubridate` - fast and user friendly way to work with dates.
* `rvest` - for scraping information off of the web.
* `RColorBrewer` - for changing graph colors
* `tidyverse` - a collection of packages to manipulate and graph data.

```{r library bank, echo=FALSE}
#====library bank====
library(readxl)
library(scales, warn.conflicts = F)
library(lubridate,warn.conflicts = F)
library(rvest, warn.conflicts = F, quietly = T)
library(RColorBrewer)
suppressPackageStartupMessages(library(tidyverse,
                                       warn.conflicts = F))
```

## The Data

Each data point represents a different animal that entered the shelter identified by an `andimal_id`. Each observation contains what the `intake_type` was and `outcome_type` was and dates of these events. In addition, there is information about the type and breed of the animal and what condition the animal was in at the time of intake and at the time of the outcome.

```{r read in file, echo=FALSE}
o_dallas_animals <- read_excel("week18_dallas_animals.xlsx", sheet = "raw", na = "NA")
```

## Data Manipulations

* Added `intake_day` and `outcome_day` which represents the day of the week when the intake or ourcome happened
* Added `total_time` which represents the number or days of the animal was at the shelter
* Grouped dog breeds which that accounted for less than 80% of the dogs into the breed `OTHER`

```{r manipulations, echo=FALSE}
dallas_animals <- o_dallas_animals %>%
  select(-c(kennel_status, tag_type, activity_number, activity_sequence, source_id,
            census_tract, receipt_number, impound_number, service_request_number,
            chip_status, year)) %>%
  rename(year = mo_year) %>%
  mutate(intake_day = wday(intake_date, label = TRUE),
         outcome_day = wday(outcome_date, label = TRUE),
         total_time = difftime(outcome_date, intake_date, units = "days"))

dog_breed <- dallas_animals %>%
  filter(animal_type == "DOG") %>%
  count(animal_breed) %>%
  rename(count_dogs = n) %>%
  arrange(desc(count_dogs)) %>%
  mutate(percent_dogs = round(count_dogs/sum(count_dogs), 2),
         cum_percent = cumsum(percent_dogs),
         new_breed = ifelse(cum_percent > 0.8, "OTHER", animal_breed))

dallas_animals <- dallas_animals %>%
  left_join(dog_breed %>%
              select(animal_breed, new_breed),
            by = "animal_breed")
```

## Data Used

```{r columns used, echo=FALSE}
data.frame(numb_rows = nrow(dallas_animals), numb_col = ncol(dallas_animals))
colnames(dallas_animals)
```

## Intake Analysis | Time Series

```{r time series intake, echo=FALSE}
dallas_animals %>%
  count(intake_date) %>%
  ggplot(aes(x = intake_date, y = n)) +
  geom_line() +
  geom_smooth(method = 'loess') +
  ggtitle("Intake Time Series") +
  xlab("Intake Date") +
  ylab("Number of Animals") +
  theme_bw() +
  theme(plot.title = element_text(face="bold"))
```

## Intake Analysis | Time Series (cont'd)

From this graph we can see we have one years worth data from the Dallas Animal Shelter. We see that the smoothing line dips in the winter months and then spikes in the spring and summer months. However, one years worth of data is not really sufficient for identifying seasonality.

## Intake Analysis | Intake Types

```{r intake types, echo=FALSE}
dallas_animals %>% count(intake_type) %>%   #count the number of animals
  ggplot(aes(x = reorder(intake_type, n), y = n)) +
  geom_bar(stat = "identity") +             #create a bar graph
  geom_text(aes(label = comma(n)),          #add labels to the graph with a 1,000's comma
            position = position_dodge(0.9),
            vjust = 0.1,
            hjust = -0.2) +
  ggtitle("Intake Types") +
  xlab("Intake Type") +
  ylab("Number of Animals") +
  scale_y_continuous(labels = comma, limits = c(0, 25000)) +
  theme(plot.title = element_text(face="bold")) +
  theme_bw() +
  coord_flip()
```

## Top Intakes Types by Day

```{r top intake by day, echo=FALSE}
dallas_animals %>% filter(intake_type == "STRAY" | intake_type == "OWNER SURRENDER") %>%
  ggplot(aes(x = intake_day, fill = intake_type)) +
  geom_bar() +
  facet_wrap( ~ intake_type) +
  ggtitle("Intake Type by Day") +
  xlab("Intake Day") +
  ylab("Number of Animals") +
  labs(fill = "Intake Type") +
  scale_y_continuous(labels = comma) +
  theme_bw() +
  theme(plot.title = element_text(face="bold")) +
  scale_fill_brewer(palette="Set1")
```

## Intake Analysis | Animal Types

```{r animal types intake, echo=FALSE}
dallas_animals %>% count(animal_type) %>%   #count the number of animals
  ggplot(aes(x = animal_type, y = n)) +
  geom_bar(stat = "identity") +             #create a bar graph
  geom_text(aes(label = comma(n)),          #add labels to the graph with a 1,000's comma
            position = position_dodge(0.9),
            vjust = -0.3) +
  ggtitle("Animal Intake Types") +
  xlab("Animal Type") +
  ylab("Number of Animals") +
  scale_y_continuous(labels = comma) +
  theme(plot.title = element_text(face="bold")) +
  theme_bw()
```

## Intake Analysis | Dogs
As expected, there are way more dogs than anything else. Because of the large percentage of dogs compared to every other animal type, it will be worth taking a closer look at dogs specifically.
As mentioned before, because there are so many dog breed types, we will lump the 20% least common types of dog breeds brought into the Dallas Animal Shelter as `OTHER`.

## Intake Analysis | Dog Breeds

```{r dog breed types, echo=FALSE}
dallas_animals %>%
  filter(animal_type == "DOG") %>%
  count(new_breed) %>%   #count the number of animals
  ggplot(aes(x = reorder(new_breed, n), y = n)) +
  geom_bar(stat = "identity") +             #create a bar graph
  geom_text(aes(label = comma(n)),          #add labels to the graph with a 1,000's comma
            position = position_dodge(0.9),
            vjust = 0.1,
            hjust = -0.2) +
  ggtitle("Count of Dog Breeds") +
  xlab("Dog Breed") +
  ylab("Number of Animals") +
  scale_y_continuous(labels = comma, limits = c(0, 6500)) +
  theme(plot.title = element_text(face="bold")) +
  theme_bw() +
  coord_flip()
```

## Intake Analysis | Dog Breed Intake Type

```{r dog breed intake, echo=FALSE}
dallas_animals %>%
  filter(animal_type == "DOG") %>%
  count(intake_type, new_breed) %>%
  ggplot(aes(x = reorder(intake_type, n),
             y = reorder(new_breed, n),
             fill = n)) +
  geom_tile() +
  ggtitle("Dog Breed Intake Types") +
  xlab("Intake Type") +
  ylab("Animal Breed") +
  labs(fill='Count of Dogs') +
  theme_bw() +
  theme(plot.title = element_text(face="bold"),
        axis.text.x = element_text(angle = 45)) +
  scale_fill_gradient(low = "white", high = "steelblue")
```

## Time at Dallas Animal Shelter




## Outcome Analysis | Time Series

```{r time series outcome, echo=FALSE}
dallas_animals %>%
  filter(!is.na(outcome_date)) %>%
  count(outcome_date) %>%
  ggplot(aes(x = outcome_date, y = n)) +
  geom_line() +
  geom_smooth(method = 'loess') +
  ggtitle("Outcome Time Series") +
  xlab("Outcome Date") +
  ylab("Number of Animals") +
  theme_bw() +
  theme(plot.title = element_text(face="bold"))
```

## Outcome Analysis | Dog Breed Outcome Type

```{r dog breed outcomes, echo=FALSE}
dallas_animals %>%
  filter(animal_type == "DOG") %>%
  count(outcome_type, new_breed) %>%
  ggplot(aes(x = reorder(outcome_type, n),
             y = reorder(new_breed, n),
             fill = n)) +
  geom_tile() +
  ggtitle("Dog Breed Outcomes Types") +
  xlab("Intake Type") +
  ylab("Animal Breed") +
  labs(fill='Count of Dogs') +
  theme_bw() +
  theme(plot.title = element_text(face="bold"),
        axis.text.x = element_text(angle = 45)) +
  scale_fill_gradient(low = "white", high = "steelblue")
```

## Outcome Analysis | Dog Breed Adoption Week Days

```{r dog breed outcomes, echo=FALSE}
dallas_animals %>%
  filter(animal_type == "DOG" & outcome_type == "ADOPTION" & !is.na(outcome_day)) %>%
  count(outcome_day, new_breed) %>%
  ggplot(aes(x = outcome_day,
             y = reorder(new_breed, n),
             fill = n)) +
  geom_tile() +
  ggtitle("Adoption Days of Dog Breed") +
  xlab("Week Day") +
  ylab("Animal Breed") +
  labs(fill='Count of Dogs') +
  theme_bw() +
  theme(plot.title = element_text(face="bold"),
        axis.text.x = element_text(angle = 45)) +
  scale_fill_gradient(low = "white", high = "steelblue")
```