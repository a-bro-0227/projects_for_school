{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Midterm exam Stat 528 Fall 2017\"\nauthor: \"Heike Hofmann\"\ndate: \"10/18/2017\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n\n# all libraries you need\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(lubridate)\nlibrary(maps)\n```\n\nFor all of the questions below incorporate  the necessary R code directy into your answers. \n\n\nThe Iowa Department of Natural Resources monitors water quality in different sites across Iowa and provides access to these records at\nhttp://programs.iowadnr.gov/iastoret/srchStations.aspx  \n\n\nData on a variety of different analytes for several sites in the state are given in the data set located at: XXX.csv\nadditional information on each of the sites can be found at: XXX.csv\n\nUse the following code to load the data in your session and get ready for the exam:\n\n```{r, cache=TRUE}\n#download.file(url, destfile=\"iowa-results.rds\")\niowa <- readRDS(\"../data/iowa-results.rds\")\nstations <- read.csv(\"../data/stationinfo.csv\")\n```\n\n\n1. (20 pts) Consider the `stations` data set. How many variables does the data set have, how many rows? Find a summary of the data and report on three properties of the data. (Hint: this summary is likely to affect your answers below, so be careful!)\nHow many different stations are there in Iowa?\nWhat is the average elevation of a station in Iowa? \n\n```{r}\ndim(stations)\n# 889 observations, 13 variables\n\nsummary(stations)\n# Organization_Name: all observations are from Iowa Dept. of  Natural Resources\n# Organization_ID is 889\n# one of the variables doesn't have a name\n# Source_Projection, Station_Type is all NAs\n# interestingly there are three stations outside of Iowa?\n# one station is listed twice: UT to East Buttrick Creek-Gowrie - Grass Ditch HWCRS\n\nstations %>% filter(State == \"Iowa\") %>% select(Station_Name) %>% unique() %>% nrow()\n# 885 - number of unique stations in Iowa; solutions with different answers get partial credit\n\nstations %>% filter(State == \"Iowa\") %>% select(ELEVATION) %>% summary()\n# the average elevation of Iowa's water stations is 945.9 feet.\n```\n\n2. (16+5 pts) Use `ggplot2` to draw a scatterplot of latitude and longitude. Color stations with an elevation of 1000 ft and above in a different color.  Comment on the result. Extra credit: draw the outline of Iowa in the same scatterplot (Hint: `library(maps)` and `map_data()`)\n\n```{r}\nlibrary(maps)\nusa <- map_data(\"state\")\nia <- usa %>% filter(region==\"iowa\")\n\nstations %>% ggplot(aes(x = LONGITUDE, y = LATITUDE)) +\n  geom_point(aes(colour=ELEVATION>=1000)) +\n  geom_path(aes(x = long, y = lat, group=group), data=ia)\n\n#  water stations with an elevation of 1000ft or above can be found in the NW of Iowa. \n# for some stations elevation is not recorded.\n\n```\n\n3. (25 pts) What is the time frame of the water quality measurements in `iowa`? Use `lubridate` on the `Date_Time` variable to find out.\nUse `ggplot2`  plot for stations 10360001, 10360003, and 10650001 the measurements (`Result`) for Escherichia coli (in `Analyte`) over time. Connect measurements at the same station by a line. In what unite are these results taken (check `Unit`). Comment on the result. \n```{r}\niowa$Date_Time <- lubridate::mdy_hms(iowa$Date_Time)\nsummary(iowa$Date_Time)\n# measurements are taken between Jan 4 2016 and Aug 8 2017.\n\niowa %>% filter(Storet_ID %in% c(10360001, 10360003, 10650001),\n                Analyte == \"Escherichia coli\") %>% select(Units) %>% unique()\n# MPN/100ml - which stands for most probable number (MPN) of coliform per 100 ml\n\niowa %>% filter(Storet_ID %in% c(10360001, 10360003, 10650001),\n                Analyte == \"Escherichia coli\") %>% \n  ggplot(aes(x = Date_Time, y = Result)) +\n  geom_point() +\n  geom_line(aes(colour=factor(Storet_ID)))\n# all three stations have elevated E-coli measurements in May 2017, but 10360001 doesn't have elevated E-coli measurements in July 2016.\n```\n\n4. (10+6 pts) Using the `iowa` data draw side-by-side boxplots of `Result` and `Analyte`. What are problems with this plot? List at least two. Extra credit for a viable solution to each problem.\n\n```{r}\niowa %>% ggplot(aes(x = Analyte, y = Result)) + geom_boxplot()\n# can't read the labels\n# two analytes completely dominate the results\n# comparisons across different units do not make sense\n\niowa %>% ggplot(aes(x = Analyte, y = Result)) + \n  geom_boxplot() +\n  coord_flip() + \n  facet_grid(Units~., scales=\"free\", space=\"free\", drop=TRUE) +\n  scale_y_log10()\n\n```\n\n5. (15 pts) Cadmium, Arsenic and Lead are metals that should not be detectable in any of our water resources. Check whether/how often there were detectable (`Detection_Limit`) traces of any of these metals in Iowa's waters. Save the result in object `metals`. For each of these metals, give a summary of how often it was detected, what its detected average and maximum was  (Hint: use `dplyr` tools).\n\n\n```{r}\nmetals <- iowa %>% \n  filter(Analyte %in% c(\"Cadmium\", \"Arsenic\", \"Lead\"),\n                Result > Detection_Limit) \nmetals %>% \n  group_by(Analyte) %>% \n  summarize(\n    n = n(), \n    mean=mean(Result), \n    max=max(Result, na.rm=TRUE)\n    )\n```\n\n\n6. (19 pts) From the `iowa` data, select variables `Analyte`, `Date_Time`, `Result`, and `Storet_ID`. Create a *wide* version of the data that includes one column for each of the results of an analyte. Draw a scatterplot of water temperature and E.coli measurements and comment (don't worry if the plot looks a bit strange).\n\n```{r}\nwide <- iowa %>%  select(Analyte, Date_Time, Result, Storet_ID) %>%\n  tidyr::spread(Analyte, Result)\nwide %>% ggplot(aes(x = `Temperature, water`, y = `Escherichia coli`)) +\n  geom_point()\n# there is no apparent relationship between water temperature and E.coli abundance.\n```",
    "created" : 1541080985304.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "50801774",
    "id" : "31D5E452",
    "lastKnownWriteTime" : 1510501762,
    "last_content_update" : 1510501762,
    "path" : "F:/School/ISU/Visual Business Analytics/Sample Midterm exam and solutions/Solutions/midterm-2017-solution.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}